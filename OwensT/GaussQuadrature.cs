using MultiPrecision;
using System.Linq;

namespace OwensT {
    internal static class GaussQuadrature<N> where N: struct, IConstant {
        internal struct Plus8 : IConstant {
            public int Value => checked(default(N).Value + 8);
        }

        public static MultiPrecision<N> T5(MultiPrecision<N> h, MultiPrecision<N> a) {
            MultiPrecision<N> h2 = h * h, a2 = a * a;

            MultiPrecision<N> n_half_h2 = -h2 / 2;

            MultiPrecision<N> s = 0;

            for (int k = 0; k < gls.Length; k++) { 
                MultiPrecision<N> r = 1 + a2 * gls[k].x * gls[k].x;

                s += gls[k].w * MultiPrecision<N>.Exp( n_half_h2 * r ) / r;
            }

            MultiPrecision<N> y = s * a / (2 * MultiPrecision<N>.PI);

            return y;
        }

        public static MultiPrecision<N> T5r2(MultiPrecision<N> h, MultiPrecision<N> a) {
            MultiPrecision<N> h2 = h * h, a2 = a * a;

            MultiPrecision<N> n_half_h2 = -h2 / 2;

            MultiPrecision<N> s = 0;

            for (int k = 0; k < gls.Length; k++) { 
                MultiPrecision<N> r = 1 + a2 * gls[k].x * gls[k].x;

                MultiPrecision<N> u = gls[k].w * MultiPrecision<N>.Exp(n_half_h2 * r) / r;

                s += u;

                if (u.Exponent < s.Exponent - MultiPrecision<N>.Bits) {
                    break;
                }
            }

            MultiPrecision<N> y = s * a / (2 * MultiPrecision<N>.PI);

            return y;
        }

        public static MultiPrecision<N> T5r3(MultiPrecision<N> h, MultiPrecision<N> a) {
            MultiPrecision<N> h2 = h * h, a2 = a * a;

            MultiPrecision<N> n_half_h2 = -h2 / 2;

            MultiPrecision<N> s = MultiPrecision<N>.Sqrt(MultiPrecision<N>.PI / 2) / (h * a)
                * MultiPrecision<N>.Exp(n_half_h2) * MultiPrecision<N>.Erf(h * a / MultiPrecision<N>.Sqrt2);

            for (int k = 0; k < gls.Length; k++) {
                MultiPrecision<N> p = a2 * gls[k].x * gls[k].x;
                MultiPrecision<N> r = 1 + p;

                MultiPrecision<N> u = gls[k].w * MultiPrecision<N>.Exp(n_half_h2 * r) * p / r;

                s -= u;
            }

            MultiPrecision<N> y = s * a / (2 * MultiPrecision<N>.PI);

            return y;
        }

        public static MultiPrecision<N> T5r4(MultiPrecision<N> h, MultiPrecision<N> a) {
            MultiPrecision<N> h2 = h * h, a2 = a * a;

            MultiPrecision<N> n_half_h2 = -h2 / 2;

            MultiPrecision<N> s = 0;

            for (int k = 0; k < rls.Length; k++) { 
                MultiPrecision<N> r = 1 + a2 * rls[k].x * rls[k].x;

                MultiPrecision<N> u = rls[k].w * MultiPrecision<N>.Exp(n_half_h2 * r) / r;

                s += u;

                if (u.Exponent < s.Exponent - MultiPrecision<N>.Bits) {
                    break;
                }
            }

            MultiPrecision<N> y = s * a / (4 * MultiPrecision<N>.PI);

            return y;
        }

        static readonly (string x, string w)[] p16 = new (string, string)[] {
            ("0.03109833832718887611232898966594919424729622295999804297479623566203052396060045650280473847560367436093422130549169321642581311930404117510269206892414490110971931784552226680659867636139334716148162238611727428727353158545464594952919423131518718721311804104099645780360579424867791460039576425675229159","0.062176616655347262321033107360613430867682469201026633101165637619757611600516149615396523425625194503519087853851464602701362417390055661083876165966694205510936782494020683348050970877058596585627805982861637629110063629486387918901283167820120400410848866574118214265174255964051869434965451730919269576"),   
            ("0.093174701560086140854450377639600347885671383922138614682889155646180251667429510717967219829878468890165304979206389128516190741193571098816165935307091247555274537928515961296672585604376288777039325000652911574210258565328603365078336490472976741989710211301385078063733474889518076614768011835193833014","0.061936067420683243384087509780830688572877056691244904942759706116954821286886866354187401260183933498508878427069806430996954149808886906787165810323960849889857022294203978778949110027392886340494985101467741481842435239472500476243580356063335902284319826410495403209952961925638703623816821419885984742"),  
            ("0.15489058999814590207162862094110950120185022005493763239673032635355782483236109395272906731935562089424967339331391711115404961201536798964452465565373396046128592522067828777826412098259268251578872714925063560927592836583665512263021657477150926083248356040756515460892157076668001991618936524841328945","0.061455899590316663756406786083915375097267575764007514309224050359059109952216967274820036443756220488580799097076302924953775850723321223701774228484418338880829192283376028473875845011706164999457296344780675361320109762038722737961650286489547307625518686085733732886355234632256824821080172416036446205"),   
            ("0.21600723687604175684728453261710133370575597251013327270362112636199019383500046874452866613192917940645804511383761846423270272278454529150361337616304962359209392135633078561739501860221477494154274851654066837769426672626721108235643176509767283341895786241081220742775161048580152652449153250927911349","0.060737970841770216031750015384811001609799273235403535723196774561759576517125053431218175029637426312887901909278230508055706485634843440805500576690293754017787639653006169158150740296842348763909250193453270243976139050649845360960180606135069617823729019788870275149918362782457341458404308169438202782"),   
            ("0.27628819377953199032764527852113018571480158713199615061350557943837692361969810276330406162380633034661326010819045909943703796608247719390218472031465641020743596120785606574742425410774661689482304105493675394285787729365150143881143623176121487172841488062063834973274465874080842452533541733498671304","0.059785058704265457509576405312585230796666042072669004585241978803619221414203277389568420163787946301926207238003146647656722092984635462180780879717560871587282326600858192066992595840535026063742209876657072362471969779924092921794048405344989345657150467319808089806377719765741328374176756135165654537"),   
            ("0.33550024541943735683698825729107169784121859303679576190043053971098619482533102261606949580266072268078782361479244577295584339711623457897328482077215232697340484125594765528389589419965119179687259692111792289612257049877594001320942532597576396780200173281667474593350226127040820649734502682099557248","0.058600849813222445835122436630848466209767513444025473313250342475354480050601002353491740282338773571348772216069530810373601601359887750234140768185427182871114015351098803751103758106424516931345992493854082003552516069690258995306741203675429684515711627828670599586681714838892572603306928150489832813"),   
            ("0.39341431189756512739422925382381727024613946867265600307903662085649772812439876996068612027333299106327111850671933278344361645431447181549626653825685983165780617084832748698312750776906147575545821937628514787574682479833903328633394889183370208466121957430139625905610589368068985626608405378265468862","0.057189925647728383723029315065993163011575372257091754936853781352804925666856383191485305132751983834326683727766239980123784949124335787968558784793924616819035470777677953451806677275235385407685891616030681477890897011880109413037795955489172302546442399594563900122280789566852904949984824288171424825"),   
            ("0.44980633497403878914713146777837581731506451346517366594148066988597085369890422148733559106442722766698878464236135744805680929647328351783670063557102216034420666149270230967984380989642480409966690646934615310689575957604512473622754933933673186804280314800813774331263603587773913959972106169330280309","0.055557744806212517623567425612269497595135299983902675817172778510318550714595731882063936899865838389170203468065640464258418217069555154589215569384631818939020983161721020185683886814757336435775389744410139830047844220036608226407984635120140691482528874885104867839081879965823582952695844478111631516"),   
            ("0.50445814490746420165145913184914119263537867827067923818273921096822637869393259878700013718329600651482130824271669842347769912737041235083852170932411908204787431985765988656656244405013092844069027121932672674470073507575231917045850644708246371195571238141771971344711956109643474892100020345354556293","0.053710621888996246523458797255664552768023213529922153045899999181596516175675679539981146389055971670639060763033358051380246806531004957800352412076979502492300179456588370957047804919958251919695732976030448922497600632162035942121966870950009720548723585071630339677688597021704323927177409662784501315"),   
            ("0.55715830451465005431552290962580160781589838223775026131646148676048945218873217670736129868390874553446057560848270675632663510293310097220844756857183334263142168361018096690359260622493527133127364237416189077535468219123368079242074466199030021269745666474731943794771126649910033190123739314103997667","0.051655703069581138489905295840095279649825449395439645099533186451192177308562865499955919291070998211945733531087230536398905174851121913358052847034832206892197271597775815649283122380044945707302272504442068639373167689486624061693252223663913029869902342770952016571975414683385608085017484484714344182"),   
            ("0.60770292718495023918038179639183289360420502067599435571213118893968564768342092214658698003171542244417471182613758581952737003862588031213717569984081394941204897168787066611038115633373043716703322591341603871195707290795805544339432422553915568527885234922198491106427610708650025879110635415892657521","0.049400938449466314921243580751432728692287050966613124792123560248069845705889393485574257611101244275880675188467353928414369477453891076759853085462861257456536877951327579414721537086990675861526409441683751742306502714091975868675691925493594304354782419468236039942673271652488326009051950948914147477"),   
            ("0.65589646568543936078162486400367981904141052838233182653093459139210847858075176246495395301787043520044527296159132027210646601966382867974037348799435644703406040413499875586992003240668498186238598958714328800700303735983330455647671733220289513278625728311270218990173571559259037378376106783165033196","0.046955051303948432965633013634987682514064306186052729965804279343365060719829183217725339278033304181271482663538918917307830280249959704077795116884950118339257048580101767053730004801302829722644142501455480022759506284879274618061213083910934067527523021365840486444054263988141707958317104283952769418"),   
            ("0.70155246870682225108954625788365572814971922848469564274092437903329224583459529696815777184132507872613616266415325990414421290334231062954835763003337234851342497236431624534211157145942873483707492813820789230304298006400386022490034703860835254301545121839746393527287413451818506013812272098401801647","0.044327504338803275492022286830394197460761298355453165663231906827622729471477282850821475453182573360805760142043318244674099766431977981899758552041681392245926735593442636860747348974572059965286955486561537204342485309896730804642229511846113047174769656156461753524976756291174054485722161557184946952"),   
            ("0.74449430222606853826053625268219424287018793132958457852477914793292979130886952004949810986074667472458619395483550277184212686567162572902631346091502485332170384490763410036675463239029387009215302188880761313081423737889562230990625296562284222806390270855120552448342932076255222228237174059096015707","0.041528463090147697422411978964067017808977975485840990077036977952185281006650533703389463978500065354319924794007627670278108847520548940198560522265861664745566829574403587261392610516244546087937267908046947341366948504015784926678813249510302896386798281024716565301311001762664097351801650571457056091"),   
            ("0.78455583290039926390530519634099120084731627255644435273885912189313102039399998768471308575807825184246422606171977037665913585822798884231269747062763151117246462029994704160141045625818320100143096642481960106033022578924403279666875418546035668044145745903530561994134802911490320243801231365328693136","0.03856875661258767524477015023638593486477170500051892651080740015226675324994747902017131814788740766969914829718052260053939146650369761468262424242688004649711185495973022782222461049405494723171516746924216115588292660115975701273902053977616136777470679296652133542602888510951141251873158873357116971"),    
            ("0.82158207085933594835625411087393953776074138334348574852337446061546866560613471799248864506512871643639387938728911254160831256922904217531000142199695806073050292329640838570103793351389531462848481486163318361753840841131571588705637813343332908083645086057194046787194416591571439470505361621971650496","0.035459835615146154160734611000975797096960000496984470912870450859971166530479970563064066804964023812669639438041990737950395529381963375565214595830173796024706880041203371474653717739027510738381681917207379654195314256928862855777677127636622583486195044550020591832539347876355042817087469695785319956"),   
            ("0.85542976942994608461136264393475746765483303948690596343832992034131863007185764421911052573699013331219636994775907657446760484312530145609727263862915226748648529259774671102329984543224082678205172285187998304942336367849853997211865174052439648078372189745841226969584795262795010244147076246556641972","0.032213728223578016648165827323003953448589058833425217158329605415911300245176463460062188525803184389503535668026847723884672027638224011746760581234295795399483718849005223094141029618630083022885445001402559596678889247546144735534223368897704502082700502985689314281977014709004273165343471841497155402"),   
            ("0.88596797952361304863754098246675363419429031075580836244655713965488732583740754516650117586236801955707908058443928596859276353394764488318274739927352261098429588468884519283328976927371898561474574082431578639987726883001290084028993292737389559167348979296753503594847209542210204887500554547780735746","0.028842993580535198029906373113232432517846865593537457835712623056265329664284339046627720054767399157484697579875098546825511830542401579445535676764338085413486881070842745263317596951266695471333677615004851477819125481079577460205644679978062217070959973355647505985875430200928076878837973286931544703"),   
            ("0.91307855665579189308973564277165709478418819169778238962272655320085243401065155628024710521500341418233960189985462447878830648260801884363587944527513739558364139773864356765392802673103690100280079468500391153850988417995519708758646827966247175563076755485366597068574770093134027277609646281077535112","0.025360673570012390440194878385442723460161259975712137339396332952037757746727527874604248564111281221094812725069774946474505342400349907321908142108763980611472578242368615135617633489170735739712566984167619172023707941628462069542065111998984356890371171826575355065476241117677557477222811331314469395"),   
            ("0.936656618944877933780874947272496602153731598095202922375054273809356131234923034418614197073816734095746044386643021855311009887057042075861069440673684999344477425452409738332218901559018670491019830146925506929845442984043422169095712235489230718372839737852862577859814204549054469709689533344860413","0.021780243170124792981592069062690341227313462357934296044027139447670830221994978692528405062919036610750543988184459389787201683069180558744227305401230414887261661705663865566154900860877968946139457454588973130627030391289554278934416656126926195411019074492775663013159990536029188954245103387947031797"),     
            ("0.95661095524280794299774564415662209405143412462604654285597908297305530629680893912045257321043523883129343674889541827582733047346055861225065834241417216024784444937444909125787654624984969473149920105221269856007819237674936891171164816063177879897096070498479218591431873663772940688085838174106471408","0.01811556071348939035125994342235461984466731704973403542645291587336228972336591075140020218097306310881509393217652274901033527355587966975536847211706490119336613990265974499290619233751181298516793677235008460745796344715672008247837162598799924140568803023732151024125724725530649426055212951646948612"),    
            ("0.97286438510669207371334410460625205366917340704995420174509627522567671898581678891754391471943381562585435883565144855698367596623401932878692135719617604227811698903159594629757742681914295144244635314132258333247824814320993038395015869074270254213414020790579304252142595274744818781853067804629029027","0.014380822761485574419378908927324349937031786170587892772101622154251736563316887592904029128875082009204694734049022319115981938711953362432782798434676189788281046046483784371018079486591376217382088846391237024266373548950513799157061634346683721705756070659005696462201053255927169266879180701044036508"),   
            ("0.98535408404800588230900962563248940401559263094540580871780922100853508147025077065679353579886930847173600487775925292119754829762009991383359221513550757422782790792815834096370631223673816433672284289840922082109579749096164733820129153363316076878075330589084196366357574302368921922870292453494344755","0.010590548383650969263569681499241022339401819086459129456334717145649160629026857353113118028706186885786629079888254035546424760618827363328159390943323003179065525420320093196531422028861332525214366508858044438874609808415754109947441294925572293357842904137775170467927111267683070613242851529982523322"),   
            ("0.994031969432090712585108200420694728157477971068323590336524789115933310244198620084750203299748818259760660094545941995854921525710760090949791243107619646498921296789129362605781409783308151637470351363532613481909570167698980994128080905303446250269733031189854680209269340627600205560349567133055886","0.0067597991957454015027788781779850318018738324064668105528787058554029967944856787527566093874153215001888105419718171291279415096115053570914447616194407900935890266684583680811662741768053259969244873142935863704016269005056434462624167822195711509108470288942381864465704162582866945349917115783396896166"),    
            ("0.9988664044200710501854594449742185059962435129040785251770386176575391083082719606000817676304540908816211142125746246395146062751602721269012718747075215374285691593278562767853983187135230076747980429953846819229059201451936042829796424039633265927034501611175851432195329432234117877340602360309654886","0.0029086225531551409584007243428554808066729964599463206185935272835507710401075371030889534746865396796712229961775201041637525208319912384405887138057352162245263117236613745907325298881366403327115219447579691089142464776280578769352296965930400516951643315492273864484850375720177734773468400998913610404"),   
        };

        static readonly (MultiPrecision<N> x, MultiPrecision<N> w)[] gls
            = p16.Select((v) => ((MultiPrecision<N>)v.x, (MultiPrecision<N>)v.w)).ToArray();

        static readonly (MultiPrecision<N> x, MultiPrecision<N> w)[] rls
            = p16.Reverse().Select((v) => (((1 - (MultiPrecision<Plus8>)v.x) / 2).Convert<N>(), (MultiPrecision<N>)v.w)).Concat(
                p16.Select((v) => (((MultiPrecision<N>)v.x + 1) / 2, (MultiPrecision<N>)v.w))
            ).ToArray();
    }
}
